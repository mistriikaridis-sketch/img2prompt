async function runQwen() {
            const loading = document.getElementById('loading');
            const resultEl = document.getElementById('result');
            
            resultEl.value = '';
            loading.classList.remove('hidden');

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        imageBase64: currentCompressedBase64,
                        style: currentStyle 
                    })
                });

                // ğŸ” å…³é”®ä¿®æ”¹ï¼šå…ˆåˆ¤æ–­å“åº”æ˜¯ä¸æ˜¯ OK
                if (!response.ok) {
                    // å¦‚æœæŠ¥é”™ï¼Œå…ˆå°è¯•è¯»æ–‡æœ¬ï¼Œçœ‹çœ‹æœåŠ¡å™¨è¯´äº†å•¥
                    const errorText = await response.text(); 
                    throw new Error(`Server Error (${response.status}): ${errorText.substring(0, 100)}...`);
                }

                // åªæœ‰ç¡®å®šæ˜¯ OK çš„ï¼Œæ‰å»è§£ JSON
                const data = await response.json();
                loading.classList.add('hidden');

                if (data.error) throw new Error(data.error);

                if (data.choices && data.choices.length > 0) {
                    const text = data.choices[0].message.content;
                    typeWriter(text);
                    saveHistory(text);
                } else {
                    throw new Error("API returned empty content.");
                }

            } catch (error) {
                loading.classList.add('hidden');
                // æŠŠçœŸå®çš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåœ¨æ¡†é‡Œ
                resultEl.value = `âŒ Connection Error:\n${error.message}\n\nğŸ‘‰ Tip: Check your Vercel Environment Variables (ALIYUN_API_KEY).`;
            }
        }